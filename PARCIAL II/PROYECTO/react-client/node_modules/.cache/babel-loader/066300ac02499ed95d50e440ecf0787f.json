{"ast":null,"code":"// import React, { useEffect, useState } from 'react';\n// import { over } from 'stompjs';\n// import SockJS from 'sockjs-client';\n// import ChatRoomUI from './ChatRoomUI';\n// var stompClient = null;\n// const ChatRoom = () => {\n//   const [privateChats, setPrivateChats] = useState(new Map());\n//   const [publicChats, setPublicChats] = useState([]);\n//   const [tab, setTab] = useState(\"CHATROOM\");\n//   const [unreadMessages, setUnreadMessages] = useState(new Map());\n//   const [userData, setUserData] = useState({\n//     username: '',\n//     receivername: '',\n//     connected: false,\n//     message: ''\n//   });\n//   useEffect(() => {\n//     console.log(userData);\n//   }, [userData]);\n//   const connect = () => {\n//     let Sock = new SockJS('http://localhost:8080/ws');\n//     stompClient = over(Sock);\n//     stompClient.connect({}, onConnected, onError);\n//   }\n// /*\n//   const onConnected = () => {\n//     setUserData({ ...userData, \"connected\": true });\n//     stompClient.subscribe('/chatroom/public', onMessageReceived);\n//     stompClient.subscribe('/user/' + userData.username + '/private', onPrivateMessage);\n//     userJoin();\n//   }*/\n//     const onConnected = () => {\n//       setUserData({ ...userData, \"connected\": true });\n//       stompClient.subscribe('/chatroom/public', onMessageReceived);\n//       stompClient.subscribe('/user/' + userData.username + '/private', onPrivateMessage);\n//       stompClient.subscribe('/user/' + userData.username + '/queue/notifications', onNotificationReceived); // Nueva suscripción\n//       userJoin();\n//   }\n//   const onNotificationReceived = (payload) => {\n//       var notification = JSON.parse(payload.body);\n//       alert(notification.message); // Muestra una alerta, puedes personalizar esto para mostrar notificaciones en tu UI\n//   }\n//   const userJoin = () => {\n//     var chatMessage = {\n//       senderName: userData.username,\n//       status: \"JOIN\"\n//     };\n//     stompClient.send(\"/app/message\", {}, JSON.stringify(chatMessage));\n//   }\n//   const onMessageReceived = (payload) => {\n//     var payloadData = JSON.parse(payload.body);\n//     switch (payloadData.status) {\n//       case \"JOIN\":\n//         if (!privateChats.get(payloadData.senderName)) {\n//           privateChats.set(payloadData.senderName, []);\n//           setPrivateChats(new Map(privateChats));\n//         }\n//         break;\n//       case \"MESSAGE\":\n//         publicChats.push(payloadData);\n//         setPublicChats([...publicChats]);\n//         break;\n//     }\n//   }\n// /*\n//   const onPrivateMessage = (payload) => {\n//     console.log(payload);\n//     var payloadData = JSON.parse(payload.body);\n//     if (privateChats.get(payloadData.senderName)) {\n//       privateChats.get(payloadData.senderName).push(payloadData);\n//       setPrivateChats(new Map(privateChats));\n//     } else {\n//       let list = [];\n//       list.push(payloadData);\n//       privateChats.set(payloadData.senderName, list);\n//       setPrivateChats(new Map(privateChats));\n//     }\n//   }*/\n//     const onPrivateMessage = (payload) => {\n//       var payloadData = JSON.parse(payload.body);\n//       if (privateChats.get(payloadData.senderName)) {\n//         privateChats.get(payloadData.senderName).push(payloadData);\n//         setPrivateChats(new Map(privateChats));\n//       } else {\n//         let list = [];\n//         list.push(payloadData);\n//         privateChats.set(payloadData.senderName, list);\n//         setPrivateChats(new Map(privateChats));\n//       }\n//       if (tab !== payloadData.senderName) {\n//         let count = unreadMessages.get(payloadData.senderName) || 0;\n//         unreadMessages.set(payloadData.senderName, count + 1);\n//         setUnreadMessages(new Map(unreadMessages));\n//       }\n//     }\n//     const handleTabChange = (name) => {\n//       setTab(name);\n//       if (unreadMessages.get(name)) {\n//         unreadMessages.set(name, 0);\n//         setUnreadMessages(new Map(unreadMessages));\n//       }\n//     };\n//   const onError = (err) => {\n//     console.log(err);\n//   }\n//   const handleMessage = (event) => {\n//     const { value } = event.target;\n//     setUserData({ ...userData, \"message\": value });\n//   }\n//   const sendValue = () => {\n//     if (stompClient) {\n//       var chatMessage = {\n//         senderName: userData.username,\n//         message: userData.message,\n//         status: \"MESSAGE\"\n//       };\n//       console.log(chatMessage);\n//       stompClient.send(\"/app/message\", {}, JSON.stringify(chatMessage));\n//       setUserData({ ...userData, \"message\": \"\" });\n//     }\n//   }\n//   const sendPrivateValue = () => {\n//     if (stompClient) {\n//       var chatMessage = {\n//         senderName: userData.username,\n//         receiverName: tab,\n//         message: userData.message,\n//         status: \"MESSAGE\"\n//       };\n//       if (userData.username !== tab) {\n//         privateChats.get(tab).push(chatMessage);\n//         setPrivateChats(new Map(privateChats));\n//       }\n//       stompClient.send(\"/app/private-message\", {}, JSON.stringify(chatMessage));\n//       setUserData({ ...userData, \"message\": \"\" });\n//     }\n//   }\n//   const handleUsername = (event) => {\n//     const { value } = event.target;\n//     setUserData({ ...userData, \"username\": value });\n//   }\n//   const registerUser = () => {\n//     connect();\n//   }\n// /*\n//   return (\n//     <ChatRoomUI\n//       userData={userData}\n//       privateChats={privateChats}\n//       publicChats={publicChats}\n//       tab={tab}\n//       setTab={setTab}\n//       handleMessage={handleMessage}\n//       sendValue={sendValue}\n//       sendPrivateValue={sendPrivateValue}\n//       handleUsername={handleUsername}\n//       registerUser={registerUser}\n//     />\n//   );*/\n//   return (\n//     <ChatRoomUI\n//       userData={userData}\n//       privateChats={privateChats}\n//       publicChats={publicChats}\n//       tab={tab}\n//       //setTab={setTab}\n//       setTab={handleTabChange}\n//       handleMessage={handleMessage}\n//       sendValue={sendValue}\n//       sendPrivateValue={sendPrivateValue}\n//       handleUsername={handleUsername}\n//       registerUser={registerUser}\n//       unreadMessages={unreadMessages}\n//       //setUnreadMessages={setUnreadMessages} // Añadir esta línea\n//     />\n//   );\n// }\n// export default ChatRoom;","map":{"version":3,"sources":["C:/Users/USER/Documents/GitHub/Distribuidas/Distribuidas/PARCIAL II/PROYECTO/react-client/src/components/ChatRoom.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA","sourcesContent":["// import React, { useEffect, useState } from 'react';\r\n// import { over } from 'stompjs';\r\n// import SockJS from 'sockjs-client';\r\n// import ChatRoomUI from './ChatRoomUI';\r\n\r\n// var stompClient = null;\r\n\r\n// const ChatRoom = () => {\r\n//   const [privateChats, setPrivateChats] = useState(new Map());\r\n//   const [publicChats, setPublicChats] = useState([]);\r\n//   const [tab, setTab] = useState(\"CHATROOM\");\r\n//   const [unreadMessages, setUnreadMessages] = useState(new Map());\r\n\r\n//   const [userData, setUserData] = useState({\r\n//     username: '',\r\n//     receivername: '',\r\n//     connected: false,\r\n//     message: ''\r\n//   });\r\n\r\n//   useEffect(() => {\r\n//     console.log(userData);\r\n//   }, [userData]);\r\n\r\n//   const connect = () => {\r\n//     let Sock = new SockJS('http://localhost:8080/ws');\r\n//     stompClient = over(Sock);\r\n//     stompClient.connect({}, onConnected, onError);\r\n//   }\r\n// /*\r\n//   const onConnected = () => {\r\n//     setUserData({ ...userData, \"connected\": true });\r\n//     stompClient.subscribe('/chatroom/public', onMessageReceived);\r\n//     stompClient.subscribe('/user/' + userData.username + '/private', onPrivateMessage);\r\n//     userJoin();\r\n//   }*/\r\n\r\n//     const onConnected = () => {\r\n//       setUserData({ ...userData, \"connected\": true });\r\n//       stompClient.subscribe('/chatroom/public', onMessageReceived);\r\n//       stompClient.subscribe('/user/' + userData.username + '/private', onPrivateMessage);\r\n//       stompClient.subscribe('/user/' + userData.username + '/queue/notifications', onNotificationReceived); // Nueva suscripción\r\n//       userJoin();\r\n//   }\r\n  \r\n//   const onNotificationReceived = (payload) => {\r\n//       var notification = JSON.parse(payload.body);\r\n//       alert(notification.message); // Muestra una alerta, puedes personalizar esto para mostrar notificaciones en tu UI\r\n//   }\r\n  \r\n\r\n//   const userJoin = () => {\r\n//     var chatMessage = {\r\n//       senderName: userData.username,\r\n//       status: \"JOIN\"\r\n//     };\r\n//     stompClient.send(\"/app/message\", {}, JSON.stringify(chatMessage));\r\n//   }\r\n\r\n//   const onMessageReceived = (payload) => {\r\n//     var payloadData = JSON.parse(payload.body);\r\n//     switch (payloadData.status) {\r\n//       case \"JOIN\":\r\n//         if (!privateChats.get(payloadData.senderName)) {\r\n//           privateChats.set(payloadData.senderName, []);\r\n//           setPrivateChats(new Map(privateChats));\r\n//         }\r\n//         break;\r\n//       case \"MESSAGE\":\r\n//         publicChats.push(payloadData);\r\n//         setPublicChats([...publicChats]);\r\n//         break;\r\n//     }\r\n//   }\r\n// /*\r\n//   const onPrivateMessage = (payload) => {\r\n//     console.log(payload);\r\n//     var payloadData = JSON.parse(payload.body);\r\n//     if (privateChats.get(payloadData.senderName)) {\r\n//       privateChats.get(payloadData.senderName).push(payloadData);\r\n//       setPrivateChats(new Map(privateChats));\r\n//     } else {\r\n//       let list = [];\r\n//       list.push(payloadData);\r\n//       privateChats.set(payloadData.senderName, list);\r\n//       setPrivateChats(new Map(privateChats));\r\n//     }\r\n//   }*/\r\n\r\n//     const onPrivateMessage = (payload) => {\r\n//       var payloadData = JSON.parse(payload.body);\r\n//       if (privateChats.get(payloadData.senderName)) {\r\n//         privateChats.get(payloadData.senderName).push(payloadData);\r\n//         setPrivateChats(new Map(privateChats));\r\n//       } else {\r\n//         let list = [];\r\n//         list.push(payloadData);\r\n//         privateChats.set(payloadData.senderName, list);\r\n//         setPrivateChats(new Map(privateChats));\r\n//       }\r\n  \r\n//       if (tab !== payloadData.senderName) {\r\n//         let count = unreadMessages.get(payloadData.senderName) || 0;\r\n//         unreadMessages.set(payloadData.senderName, count + 1);\r\n//         setUnreadMessages(new Map(unreadMessages));\r\n//       }\r\n//     }\r\n\r\n//     const handleTabChange = (name) => {\r\n//       setTab(name);\r\n//       if (unreadMessages.get(name)) {\r\n//         unreadMessages.set(name, 0);\r\n//         setUnreadMessages(new Map(unreadMessages));\r\n//       }\r\n//     };\r\n    \r\n\r\n//   const onError = (err) => {\r\n//     console.log(err);\r\n//   }\r\n\r\n//   const handleMessage = (event) => {\r\n//     const { value } = event.target;\r\n//     setUserData({ ...userData, \"message\": value });\r\n//   }\r\n\r\n//   const sendValue = () => {\r\n//     if (stompClient) {\r\n//       var chatMessage = {\r\n//         senderName: userData.username,\r\n//         message: userData.message,\r\n//         status: \"MESSAGE\"\r\n//       };\r\n//       console.log(chatMessage);\r\n//       stompClient.send(\"/app/message\", {}, JSON.stringify(chatMessage));\r\n//       setUserData({ ...userData, \"message\": \"\" });\r\n//     }\r\n//   }\r\n\r\n//   const sendPrivateValue = () => {\r\n//     if (stompClient) {\r\n//       var chatMessage = {\r\n//         senderName: userData.username,\r\n//         receiverName: tab,\r\n//         message: userData.message,\r\n//         status: \"MESSAGE\"\r\n//       };\r\n\r\n//       if (userData.username !== tab) {\r\n//         privateChats.get(tab).push(chatMessage);\r\n//         setPrivateChats(new Map(privateChats));\r\n//       }\r\n//       stompClient.send(\"/app/private-message\", {}, JSON.stringify(chatMessage));\r\n//       setUserData({ ...userData, \"message\": \"\" });\r\n//     }\r\n//   }\r\n\r\n//   const handleUsername = (event) => {\r\n//     const { value } = event.target;\r\n//     setUserData({ ...userData, \"username\": value });\r\n//   }\r\n\r\n//   const registerUser = () => {\r\n//     connect();\r\n//   }\r\n// /*\r\n//   return (\r\n//     <ChatRoomUI\r\n//       userData={userData}\r\n//       privateChats={privateChats}\r\n//       publicChats={publicChats}\r\n//       tab={tab}\r\n//       setTab={setTab}\r\n//       handleMessage={handleMessage}\r\n//       sendValue={sendValue}\r\n//       sendPrivateValue={sendPrivateValue}\r\n//       handleUsername={handleUsername}\r\n//       registerUser={registerUser}\r\n//     />\r\n//   );*/\r\n\r\n//   return (\r\n//     <ChatRoomUI\r\n//       userData={userData}\r\n//       privateChats={privateChats}\r\n//       publicChats={publicChats}\r\n//       tab={tab}\r\n//       //setTab={setTab}\r\n//       setTab={handleTabChange}\r\n//       handleMessage={handleMessage}\r\n//       sendValue={sendValue}\r\n//       sendPrivateValue={sendPrivateValue}\r\n//       handleUsername={handleUsername}\r\n//       registerUser={registerUser}\r\n//       unreadMessages={unreadMessages}\r\n//       //setUnreadMessages={setUnreadMessages} // Añadir esta línea\r\n//     />\r\n//   );\r\n  \r\n  \r\n// }\r\n\r\n// export default ChatRoom;\r\n"]},"metadata":{},"sourceType":"module"}